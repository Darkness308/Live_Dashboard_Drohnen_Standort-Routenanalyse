<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MORPHEUS Dashboard - Interaktives Karten-Dashboard mit Flotten√ºberwachung und TA-L√§rm Monitoring">
    <meta name="keywords" content="Drohnen, Dashboard, TA L√§rm, Routenoptimierung, MORPHEUS, Leaflet, Flotten-Tracking">
    <meta name="author" content="MORPHEUS Project">

    <title>MORPHEUS Dashboard - Interaktives Karten-Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="assets/styles.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÅ</text></svg>">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header role="banner">
        <nav class="container mx-auto px-4 py-3" role="navigation" aria-label="Main navigation">
            <div class="flex flex-wrap items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl" role="img" aria-label="Drone icon">üöÅ</span>
                    <div>
                        <h1>MORPHEUS Dashboard</h1>
                        <p id="headerSubtitle">Interaktives Karten-Dashboard</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4 mt-2 sm:mt-0">
                    <!-- Language Toggle -->
                    <div class="flex items-center space-x-2">
                        <select id="languageSelect"
                                class="bg-gray-100 border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                aria-label="Language selection">
                            <option value="de">DE</option>
                            <option value="en">EN</option>
                        </select>
                    </div>

                    <!-- Compliance Status -->
                    <div class="flex items-center space-x-2">
                        <span class="compliance-indicator compliant" role="status"></span>
                        <span id="complianceStatus">TA-L√§rm Konform</span>
                    </div>

                    <!-- Last Update -->
                    <span class="last-update" id="lastUpdate">--:--:--</span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Tab Navigation mit Farb-Leitsystem -->
    <div class="container mx-auto px-4 pt-4">
        <!-- Farb-Legende f√ºr kognitive Entlastung -->
        <div class="nav-legend" role="navigation" aria-label="Farb-Legende">
            <div class="nav-legend-item">
                <span class="nav-legend-dot" style="background: var(--nav-blue);"></span>
                <span>Karten</span>
            </div>
            <div class="nav-legend-item">
                <span class="nav-legend-dot" style="background: var(--nav-purple);"></span>
                <span>Flotte</span>
            </div>
            <div class="nav-legend-item">
                <span class="nav-legend-dot" style="background: var(--nav-green);"></span>
                <span>L√§rmschutz</span>
            </div>
            <div class="nav-legend-item">
                <span class="nav-legend-dot" style="background: var(--nav-yellow);"></span>
                <span>Warnung</span>
            </div>
            <div class="nav-legend-item">
                <span class="nav-legend-dot" style="background: var(--nav-red);"></span>
                <span>Kritisch</span>
            </div>
        </div>

        <div class="tab-navigation" role="tablist">
            <button class="tab-button active" data-tab="map" data-nav-color="blue" role="tab" aria-selected="true" aria-controls="tab-map">
                <span class="nav-indicator nav-indicator-blue"></span>
                <span id="tabMapLabel">Interaktive Karte</span>
            </button>
            <button class="tab-button" data-tab="fleet" data-nav-color="purple" role="tab" aria-selected="false" aria-controls="tab-fleet">
                <span class="nav-indicator nav-indicator-purple"></span>
                <span id="tabFleetLabel">Flottenstatus</span>
            </button>
            <button class="tab-button" data-tab="noise" data-nav-color="green" role="tab" aria-selected="false" aria-controls="tab-noise">
                <span class="nav-indicator nav-indicator-green"></span>
                <span id="tabNoiseLabel">L√§rmschutz</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content" class="container mx-auto px-4 py-4" role="main">

        <!-- ============================================= -->
        <!-- TAB 1: INTERACTIVE MAP DASHBOARD -->
        <!-- ============================================= -->
        <div id="tab-map" class="tab-content active" role="tabpanel" aria-labelledby="tabMapLabel">

            <!-- Quick Stats Row -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4">
                <div class="metric-card dashboard-card bg-white">
                    <div class="metric-icon">üõ´</div>
                    <div class="metric-value text-blue-600" id="activeFlights">3</div>
                    <div class="metric-label" id="activeFlightsLabel">Aktive Fl√ºge</div>
                </div>
                <div class="metric-card dashboard-card bg-white">
                    <div class="metric-icon">üìç</div>
                    <div class="metric-value text-green-600">10</div>
                    <div class="metric-label" id="measurementPointsLabel">Messpunkte</div>
                </div>
                <div class="metric-card dashboard-card bg-white">
                    <div class="metric-icon">‚úÖ</div>
                    <div class="metric-value text-green-600" id="compliantPoints">8</div>
                    <div class="metric-label" id="compliantLabel">Konform</div>
                </div>
                <div class="metric-card dashboard-card bg-white">
                    <div class="metric-icon">‚ö†Ô∏è</div>
                    <div class="metric-value text-amber-600" id="warningPoints">2</div>
                    <div class="metric-label" id="warningsLabel">Warnungen</div>
                </div>
            </div>

            <!-- Map Section -->
            <section class="dashboard-section" aria-labelledby="map-heading">
                <div class="section-header">
                    <h2 id="map-heading" class="section-title">
                        <span id="mapTitle">Routen & L√§rmzonen</span>
                    </h2>
                </div>

                <!-- Map Controls -->
                <div class="map-controls-panel">
                    <div class="map-controls-grid">
                        <!-- Layer Controls -->
                        <div class="control-group">
                            <span class="control-label" id="layersLabel">Layer:</span>
                        </div>

                        <label class="control-group cursor-pointer">
                            <span class="route-dot" style="background: #EF4444"></span>
                            <span class="text-sm">Route A</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked data-leaflet-route="route_a">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>

                        <label class="control-group cursor-pointer">
                            <span class="route-dot" style="background: #22C55E"></span>
                            <span class="text-sm">Route B</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked data-leaflet-route="route_b">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>

                        <label class="control-group cursor-pointer">
                            <span class="route-dot" style="background: #F97316"></span>
                            <span class="text-sm">Route C</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked data-leaflet-route="route_c">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>

                        <div class="border-l border-gray-300 h-6 mx-2"></div>

                        <label class="control-group cursor-pointer">
                            <span class="text-sm" id="heatmapLabel">Heatmap</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="leafletHeatmapToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>

                        <label class="control-group cursor-pointer">
                            <span class="text-sm" id="zonesLabel">L√§rmzonen</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="noiseZonesToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>
                    </div>
                </div>

                <!-- Leaflet Map Container -->
                <div id="leaflet-map" role="application" aria-label="Interactive map showing drone routes, noise zones, and measurement points"></div>
            </section>

            <!-- Route Comparison Table -->
            <section class="dashboard-section" aria-labelledby="route-comparison-heading">
                <h3 id="route-comparison-heading" class="section-title mb-4">
                    <span id="routeComparisonTitle">Routenvergleich</span>
                </h3>
                <div class="overflow-x-auto">
                    <table class="route-table" role="table">
                        <thead>
                            <tr>
                                <th scope="col"><span id="colRoute">Route</span></th>
                                <th scope="col"><span id="colDistance">Distanz</span></th>
                                <th scope="col"><span id="colDuration">Flugzeit</span></th>
                                <th scope="col"><span id="colNoise">L√§rmbelastung</span></th>
                                <th scope="col"><span id="colEnergy">Energie</span></th>
                                <th scope="col"><span id="colStatus">Status</span></th>
                            </tr>
                        </thead>
                        <tbody id="routeTableBody">
                            <tr>
                                <td><span class="font-semibold" style="color: #EF4444">‚óè Route A - Optimiert</span></td>
                                <td>12.3 km</td>
                                <td>8 min</td>
                                <td>48 dB(A)</td>
                                <td>72%</td>
                                <td><span class="status-badge success">‚úì Konform</span></td>
                            </tr>
                            <tr>
                                <td><span class="font-semibold" style="color: #22C55E">‚óè Route B - Standard</span></td>
                                <td>10.8 km</td>
                                <td>7 min</td>
                                <td>52 dB(A)</td>
                                <td>65%</td>
                                <td><span class="status-badge success">‚úì Konform</span></td>
                            </tr>
                            <tr>
                                <td><span class="font-semibold" style="color: #F97316">‚óè Route C - Schnell</span></td>
                                <td>9.5 km</td>
                                <td>5 min</td>
                                <td>58 dB(A)</td>
                                <td>58%</td>
                                <td><span class="status-badge warning">‚ö† Grenzwertnah</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- ============================================= -->
        <!-- TAB 2: FLEET STATUS DASHBOARD -->
        <!-- ============================================= -->
        <div id="tab-fleet" class="tab-content" role="tabpanel" aria-labelledby="tabFleetLabel">

            <!-- Fleet Tracker -->
            <section class="dashboard-section" aria-labelledby="fleet-heading">
                <div id="fleet-tracker"></div>
            </section>

            <!-- Two Column Layout -->
            <div class="dashboard-grid dashboard-grid-2">
                <!-- Flight Schedule -->
                <section class="dashboard-section" aria-labelledby="schedule-heading">
                    <div id="flight-schedule"></div>
                </section>

                <!-- Daily Flights Chart -->
                <section class="dashboard-section" aria-labelledby="flights-chart-heading">
                    <h3 id="flights-chart-heading" class="section-title mb-4">
                        <span id="flightsChartTitle">T√§gliche Fl√ºge</span>
                    </h3>
                    <div class="chart-container">
                        <canvas id="flightsChart" role="img" aria-label="Daily flights chart"></canvas>
                    </div>
                </section>
            </div>

            <!-- Performance Metrics -->
            <section class="dashboard-section" aria-labelledby="performance-heading">
                <div id="performance-metrics"></div>
            </section>
        </div>

        <!-- ============================================= -->
        <!-- TAB 3: NOISE PROTECTION DASHBOARD -->
        <!-- ============================================= -->
        <div id="tab-noise" class="tab-content" role="tabpanel" aria-labelledby="tabNoiseLabel">

            <!-- Noise Statistics -->
            <section class="dashboard-section" aria-labelledby="noise-stats-heading">
                <h3 id="noise-stats-heading" class="section-title mb-4">
                    <span id="noiseStatsTitle">√úbersicht</span>
                </h3>
                <div id="noise-stats"></div>
            </section>

            <!-- Immissionsort Matrix -->
            <section class="dashboard-section" aria-labelledby="matrix-heading">
                <div id="immissionsort-matrix"></div>
            </section>

            <!-- Two Column Layout -->
            <div class="dashboard-grid dashboard-grid-2">
                <!-- 24h Noise Chart -->
                <section class="dashboard-section" aria-labelledby="noise-chart-heading">
                    <h3 id="noise-chart-heading" class="section-title mb-4">
                        <span id="noise24hTitle">24-Stunden L√§rmverlauf</span>
                    </h3>
                    <div class="chart-container">
                        <canvas id="noise24hChart" role="img" aria-label="24-hour noise chart"></canvas>
                    </div>
                </section>

                <!-- TA-L√§rm Reference -->
                <section class="dashboard-section" aria-labelledby="reference-heading">
                    <div id="ta-laerm-reference"></div>
                </section>
            </div>

            <!-- Compliance Status -->
            <section class="dashboard-section" aria-labelledby="compliance-section-heading">
                <h3 id="compliance-section-heading" class="section-title mb-4">
                    <span id="complianceSectionTitle">Regulatory Compliance</span>
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-gray-800">TA L√§rm 1998</h4>
                            <span class="compliance-indicator compliant"></span>
                        </div>
                        <p class="text-sm text-gray-600">Technische Anleitung zum Schutz gegen L√§rm</p>
                        <span class="status-badge success mt-2">‚úì Konform</span>
                    </div>
                    <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-gray-800">EU 2019/947</h4>
                            <span class="compliance-indicator compliant"></span>
                        </div>
                        <p class="text-sm text-gray-600">EU Drohnenverordnung</p>
                        <span class="status-badge success mt-2">‚úì Konform</span>
                    </div>
                    <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-gray-800">SAIL III</h4>
                            <span class="compliance-indicator compliant"></span>
                        </div>
                        <p class="text-sm text-gray-600">Specific Assurance & Integrity Level</p>
                        <span class="status-badge success mt-2">‚úì Validiert</span>
                    </div>
                </div>
            </section>
        </div>

    </main>

    <!-- Footer -->
    <footer role="contentinfo">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-between items-center">
                <p class="text-sm" id="footerText">¬© 2024 MORPHEUS Dashboard - Drohnen-Routenanalyse</p>
                <p class="text-xs text-gray-400" id="footerNote">
                    Entwickelt f√ºr automatisierte Drohnen-Routenanalyse unter Ber√ºcksichtigung europ√§ischer Regularien
                </p>
            </div>
        </div>
    </footer>

    <!-- Performance & Optimization (l√§dt zuerst) -->
    <script src="assets/performance.js"></script>

    <!-- Load data and modules -->
    <script src="assets/api-client.js"></script>
    <script src="assets/data.js"></script>
    <script src="assets/leaflet-map.js"></script>
    <script src="assets/fleet-dashboard.js"></script>
    <script src="assets/noise-dashboard.js"></script>
    <script src="assets/charts.js"></script>

    <!-- Optional: 3D Visualization (lazy loaded) -->
    <script>
        // 3D-Module nur laden wenn ben√∂tigt
        window.load3DModule = async function(type = 'cesium') {
            if (type === 'cesium' && !window.MORPHEUS_CESIUM) {
                const script = document.createElement('script');
                script.src = 'assets/cesium-3d.js';
                document.head.appendChild(script);
                return new Promise(resolve => script.onload = resolve);
            }
            if (type === 'google' && !window.MORPHEUS_MAPS_3D) {
                const script = document.createElement('script');
                script.src = 'assets/google-maps-3d.js';
                document.head.appendChild(script);
                return new Promise(resolve => script.onload = resolve);
            }
        };
    </script>

    <!-- Dark Theme Chart.js Configuration -->
    <script>
        // Global Chart.js Dark Theme Configuration
        Chart.defaults.color = '#a0a0b0';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.08)';
        Chart.defaults.backgroundColor = 'rgba(0, 212, 255, 0.1)';

        // Plugin for dark theme backgrounds
        Chart.defaults.plugins.legend.labels.color = '#a0a0b0';
        Chart.defaults.plugins.title.color = '#f0f0f5';

        // Scale defaults for dark theme
        Chart.defaults.scale.grid.color = 'rgba(255, 255, 255, 0.06)';
        Chart.defaults.scale.ticks.color = '#707080';
    </script>

    <!-- Main Application Script -->
    <script>
        // Current language
        let currentLang = 'de';

        // Translations
        const translations = {
            de: {
                headerSubtitle: 'Interaktives Karten-Dashboard',
                complianceStatus: 'TA-L√§rm Konform',
                tabMapLabel: 'üó∫Ô∏è Interaktive Karte',
                tabFleetLabel: 'üöÅ Flottenstatus',
                tabNoiseLabel: 'üîä L√§rmschutz',
                activeFlightsLabel: 'Aktive Fl√ºge',
                measurementPointsLabel: 'Messpunkte',
                compliantLabel: 'Konform',
                warningsLabel: 'Warnungen',
                mapTitle: 'Routen & L√§rmzonen',
                layersLabel: 'Layer:',
                heatmapLabel: 'Heatmap',
                zonesLabel: 'L√§rmzonen',
                routeComparisonTitle: 'Routenvergleich',
                colRoute: 'Route',
                colDistance: 'Distanz',
                colDuration: 'Flugzeit',
                colNoise: 'L√§rmbelastung',
                colEnergy: 'Energie',
                colStatus: 'Status',
                flightsChartTitle: 'T√§gliche Fl√ºge',
                noiseStatsTitle: '√úbersicht',
                noise24hTitle: '24-Stunden L√§rmverlauf',
                complianceSectionTitle: 'Regulatory Compliance',
                footerText: '¬© 2024 MORPHEUS Dashboard - Drohnen-Routenanalyse',
                footerNote: 'Entwickelt f√ºr automatisierte Drohnen-Routenanalyse unter Ber√ºcksichtigung europ√§ischer Regularien'
            },
            en: {
                headerSubtitle: 'Interactive Map Dashboard',
                complianceStatus: 'TA Noise Compliant',
                tabMapLabel: 'üó∫Ô∏è Interactive Map',
                tabFleetLabel: 'üöÅ Fleet Status',
                tabNoiseLabel: 'üîä Noise Protection',
                activeFlightsLabel: 'Active Flights',
                measurementPointsLabel: 'Measurement Points',
                compliantLabel: 'Compliant',
                warningsLabel: 'Warnings',
                mapTitle: 'Routes & Noise Zones',
                layersLabel: 'Layers:',
                heatmapLabel: 'Heatmap',
                zonesLabel: 'Noise Zones',
                routeComparisonTitle: 'Route Comparison',
                colRoute: 'Route',
                colDistance: 'Distance',
                colDuration: 'Flight Time',
                colNoise: 'Noise Exposure',
                colEnergy: 'Energy',
                colStatus: 'Status',
                flightsChartTitle: 'Daily Flights',
                noiseStatsTitle: 'Overview',
                noise24hTitle: '24-Hour Noise Trend',
                complianceSectionTitle: 'Regulatory Compliance',
                footerText: '¬© 2024 MORPHEUS Dashboard - Drone Route Analysis',
                footerNote: 'Developed for automated drone route analysis considering European regulations'
            }
        };

        // Update page language
        function updateLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;

            // Update all translatable elements
            Object.keys(translations[lang]).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = translations[lang][key];
                }
            });

            // Update module languages
            if (typeof updateMapLanguage === 'function') {
                updateMapLanguage(lang);
            }
            if (typeof updateFleetLanguage === 'function') {
                updateFleetLanguage(lang);
            }
            if (typeof updateNoiseLanguage === 'function') {
                updateNoiseLanguage(lang);
            }
        }

        // Tab navigation
        function initTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;

                    // Update buttons
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    button.classList.add('active');
                    button.setAttribute('aria-selected', 'true');

                    // Update content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`tab-${targetTab}`).classList.add('active');
                });
            });
        }

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('de-DE', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = timeStr;
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize tabs
            initTabs();

            // Initialize Leaflet map
            initLeafletMap();

            // Initialize Fleet Dashboard
            initFleetDashboard();

            // Initialize Noise Dashboard
            initNoiseDashboard();

            // Language selector
            document.getElementById('languageSelect').addEventListener('change', (e) => {
                updateLanguage(e.target.value);
            });

            // Update timestamp
            updateTimestamp();
            setInterval(updateTimestamp, 1000);

            console.info('MORPHEUS Dashboard initialized');
        });
    </script>
</body>
</html>
