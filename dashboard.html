<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MORPHEUS Dashboard - Interaktives Karten-Dashboard mit Google Maps 3D und Leaflet">
    <meta name="keywords" content="Drohnen, Dashboard, TA L√§rm, Routenoptimierung, MORPHEUS, Leaflet, Google Maps, 3D">
    <meta name="author" content="MORPHEUS Project">

    <title>MORPHEUS Dashboard - Interaktives Karten-Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Custom Scripts -->
    <script src="assets/api-client.js"></script>
    <script src="assets/google-maps-3d.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="assets/styles.css">
    
    <style>
        /* Map Container Styles */
        #map, #google-map-3d {
            height: 600px;
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .map-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .map-toggle-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .map-toggle-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-online {
            background-color: #10b981;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÅ</text></svg>">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header role="banner" class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg">
        <nav class="container mx-auto px-4 py-3" role="navigation" aria-label="Main navigation">
            <div class="flex flex-wrap items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl" role="img" aria-label="Drone icon">üöÅ</span>
                    <div>
                        <h1 class="text-2xl font-bold">MORPHEUS Dashboard</h1>
                        <p class="text-sm text-blue-200">Google Maps 3D + Leaflet Integration</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4 mt-2 sm:mt-0">
                    <!-- WebSocket Status -->
                    <div class="flex items-center space-x-2 bg-white/10 px-3 py-1 rounded">
                        <span class="status-indicator status-online" id="wsStatus"></span>
                        <span class="text-sm" id="wsStatusText">Live</span>
                    </div>
                    
                    <!-- Last Update -->
                    <span class="text-sm text-blue-200" id="lastUpdate">--:--:--</span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="container mx-auto px-4 py-6" role="main">

        <!-- Control Panel -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Active Flights -->
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600" id="activeFlights">3</div>
                    <div class="text-sm text-gray-600">Aktive Fl√ºge</div>
                </div>
                
                <!-- Routes -->
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600" id="routeCount">3</div>
                    <div class="text-sm text-gray-600">Routen</div>
                </div>
                
                <!-- TA L√§rm Status -->
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600">‚úì</div>
                    <div class="text-sm text-gray-600" id="complianceStatus">TA-L√§rm Konform</div>
                </div>
            </div>
        </div>

        <!-- Map Container with Toggle -->
        <div class="map-container">
            <button class="map-toggle-btn" id="mapToggleBtn" onclick="toggleMapView()">
                <span id="mapToggleText">üó∫Ô∏è 3D-Ansicht umschalten</span>
            </button>
            
            <!-- Leaflet Map (Default) -->
            <div id="map"></div>
            
            <!-- Google Maps 3D (Hidden by default) -->
            <div id="google-map-3d" class="hidden"></div>
        </div>

        <!-- Route Information -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">üìç Routen-√úbersicht</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">Route</th>
                            <th class="px-4 py-2 text-left">Farbe</th>
                            <th class="px-4 py-2 text-right">Distanz</th>
                            <th class="px-4 py-2 text-left">Status</th>
                        </tr>
                    </thead>
                    <tbody id="routeTable">
                        <tr>
                            <td class="px-4 py-2">Route A - Direktroute</td>
                            <td class="px-4 py-2"><span class="inline-block w-4 h-4 rounded" style="background-color: #0000FF;"></span> Blau</td>
                            <td class="px-4 py-2 text-right">0,8 km</td>
                            <td class="px-4 py-2"><span class="text-green-600">‚úì Aktiv</span></td>
                        </tr>
                        <tr class="bg-gray-50">
                            <td class="px-4 py-2">Route B - Optimiert</td>
                            <td class="px-4 py-2"><span class="inline-block w-4 h-4 rounded" style="background-color: #00FF00;"></span> Gr√ºn</td>
                            <td class="px-4 py-2 text-right">0,9 km</td>
                            <td class="px-4 py-2"><span class="text-gray-400">‚óã Inaktiv</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2">Route C - L√§rmvermeidend</td>
                            <td class="px-4 py-2"><span class="inline-block w-4 h-4 rounded" style="background-color: #FF8800;"></span> Orange</td>
                            <td class="px-4 py-2 text-right">1,0 km</td>
                            <td class="px-4 py-2"><span class="text-gray-400">‚óã Inaktiv</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Debug Panel (Optional) -->
        <div class="bg-gray-50 rounded-lg p-4 text-xs">
            <h3 class="font-bold mb-2">Debug Info</h3>
            <div id="debugInfo" class="font-mono text-gray-600">
                <div>Map Mode: <span id="currentMapMode">Leaflet</span></div>
                <div>WebSocket: <span id="wsConnectionStatus">Connecting...</span></div>
                <div>Routes Loaded: <span id="routesLoaded">0</span></div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
        <p>&copy; 2024 MORPHEUS Project | <a href="https://github.com/Darkness308/Live_Dashboard_Drohnen_Standort-Routenanalyse" class="text-blue-300 hover:text-blue-100">GitHub</a></p>
    </footer>

copilot/featuregoogle-maps-3d-integration

    <!-- Load data and modules -->
    <script src="assets/api-client.js"></script>
    <script src="assets/data.js"></script>
    <script src="assets/leaflet-map.js"></script>
    <script src="assets/fleet-dashboard.js"></script>
    <script src="assets/noise-dashboard.js"></script>
    <script src="assets/charts.js"></script>

    <!-- Dark Theme Chart.js Configuration -->
    <script>
        // Global Chart.js Dark Theme Configuration
        Chart.defaults.color = '#a0a0b0';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.08)';
        Chart.defaults.backgroundColor = 'rgba(0, 212, 255, 0.1)';

        // Plugin for dark theme backgrounds
        Chart.defaults.plugins.legend.labels.color = '#a0a0b0';
        Chart.defaults.plugins.title.color = '#f0f0f5';

        // Scale defaults for dark theme
        Chart.defaults.scale.grid.color = 'rgba(255, 255, 255, 0.06)';
        Chart.defaults.scale.ticks.color = '#707080';
    </script>

    <!-- Main Application Script -->
main
    <script>
        // =============================================================================
        // Global State
        // =============================================================================
        let currentMapMode = 'leaflet'; // 'leaflet' or 'google'
        let leafletMap = null;
        let googleMapInitialized = false;
        let wsConnection = null;

        // =============================================================================
        // Leaflet Map Initialization (Default)
        // =============================================================================
        function initLeafletMap() {
            console.log('Initializing Leaflet map...');
            
            const iserlohnCenter = [51.373, 7.701];
            
            leafletMap = L.map('map').setView(iserlohnCenter, 14);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(leafletMap);
            
            // Add a marker for Iserlohn center
            L.marker(iserlohnCenter)
                .addTo(leafletMap)
                .bindPopup('<b>Iserlohn Zentrum</b><br>Drohnen-Operationsgebiet')
                .openPopup();
            
            console.log('Leaflet map initialized');
        }

        // =============================================================================
        // Google Maps 3D Initialization
        // =============================================================================
        async function initGoogleMaps() {
            if (googleMapInitialized) {
                console.log('Google Maps already initialized');
                return;
            }
            
            console.log('Initializing Google Maps 3D...');
            
            try {
                await MORPHEUS_GMAPS.init('google-map-3d', {
                    center: { lat: 51.373, lng: 7.701 },
                    zoom: 17
                });
                
                googleMapInitialized = true;
                console.log('Google Maps 3D initialized');
                
                // Load routes from backend
                loadRoutes();
                
            } catch (error) {
                console.error('Failed to initialize Google Maps:', error);
                alert('Google Maps konnte nicht geladen werden. Bitte API-Key konfigurieren.');
            }
        }

        // =============================================================================
        // Map Toggle Function
        // =============================================================================
        function toggleMapView() {
            const leafletContainer = document.getElementById('map');
            const googleContainer = document.getElementById('google-map-3d');
            const toggleText = document.getElementById('mapToggleText');
            const currentModeDisplay = document.getElementById('currentMapMode');
            
            if (currentMapMode === 'leaflet') {
                // Switch to Google Maps 3D
                leafletContainer.classList.add('hidden');
                googleContainer.classList.remove('hidden');
                currentMapMode = 'google';
                toggleText.textContent = 'üó∫Ô∏è 2D-Ansicht umschalten';
                currentModeDisplay.textContent = 'Google Maps 3D';
                
                // Initialize Google Maps if not done yet
                if (!googleMapInitialized) {
                    initGoogleMaps();
                }
                
            } else {
                // Switch to Leaflet
                googleContainer.classList.add('hidden');
                leafletContainer.classList.remove('hidden');
                currentMapMode = 'leaflet';
                toggleText.textContent = 'üó∫Ô∏è 3D-Ansicht umschalten';
                currentModeDisplay.textContent = 'Leaflet';
            }
            
            console.log('Map view toggled to:', currentMapMode);
        }

        // =============================================================================
        // Load Routes from Backend
        // =============================================================================
        async function loadRoutes() {
            try {
                console.log('Loading routes from backend...');
                const data = await MORPHEUS_API.fetchRoutes();
                
                if (data && data.routes) {
                    console.log('Routes loaded:', data.routes.length);
                    document.getElementById('routesLoaded').textContent = data.routes.length;
                    
                    if (googleMapInitialized) {
                        MORPHEUS_GMAPS.renderRoutes(data.routes);
                    }
                    
                    // Update route count
                    document.getElementById('routeCount').textContent = data.routes.length;
                }
                
            } catch (error) {
                console.warn('Could not load routes from backend:', error);
                document.getElementById('routesLoaded').textContent = 'Error';
            }
        }

        // =============================================================================
        // WebSocket Connection
        // =============================================================================
        function connectWebSocket() {
            console.log('Connecting to WebSocket...');
            
            try {
                wsConnection = MORPHEUS_API.connectWs(
                    // onMessage
                    (data) => {
                        console.log('WebSocket message:', data);
                        if (googleMapInitialized && currentMapMode === 'google') {
                            MORPHEUS_GMAPS.handleLiveUpdate(data);
                        }
                    },
                    // onOpen
                    () => {
                        console.log('WebSocket connected');
                        document.getElementById('wsStatus').classList.add('status-online');
                        document.getElementById('wsStatusText').textContent = 'Live';
                        document.getElementById('wsConnectionStatus').textContent = 'Connected';
                    },
                    // onClose
                    () => {
                        console.log('WebSocket disconnected');
                        document.getElementById('wsStatus').classList.remove('status-online');
                        document.getElementById('wsStatusText').textContent = 'Offline';
                        document.getElementById('wsConnectionStatus').textContent = 'Disconnected';
                    },
                    // onError
                    (error) => {
                        console.error('WebSocket error:', error);
                        document.getElementById('wsConnectionStatus').textContent = 'Error';
                    }
                );
                
            } catch (error) {
                console.warn('WebSocket not available:', error);
                document.getElementById('wsConnectionStatus').textContent = 'Not Available';
            }
        }

        // =============================================================================
        // Update Clock
        // =============================================================================
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE');
            document.getElementById('lastUpdate').textContent = timeString;
        }

        // =============================================================================
        // Initialize Dashboard
        // =============================================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard initializing...');
            
            // Initialize Leaflet (default map)
            initLeafletMap();
            
            // Start clock
            updateClock();
            setInterval(updateClock, 1000);
            
            // Connect WebSocket
            setTimeout(() => {
                connectWebSocket();
            }, 1000);
            
            console.log('Dashboard initialized');
        });
    </script>
</body>
</html>
